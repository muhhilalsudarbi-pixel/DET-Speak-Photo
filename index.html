<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DET — Speak About the Photo (5 sentences, 90s)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--grey:#e4e4e4;--text:#3c3c3c;--success:#2ec748;--danger:#e74c3c;--primary:#4c82f7;--bg:#fafafa}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:"Fredoka",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;display:grid;place-items:center;min-height:100vh}
    .app{width:min(980px,92vw);background:#fff;border:1px solid var(--grey);border-radius:20px;box-shadow:0 12px 30px rgba(0,0,0,.06);overflow:hidden;margin:20px 0 40px}
    header{display:flex;align-items:center;gap:14px;padding:18px 22px;border-bottom:1px solid var(--grey)}
    .logo{width:42px;height:42px;display:grid;place-items:center;border-radius:12px;background:#e9f2ff;color:var(--primary);font-weight:700}
    header h1{font-size:20px;font-weight:700;margin:0}.sub{margin-left:auto;font-size:13px;color:#6b7280}
    .toolbar{display:grid;grid-template-columns:1fr auto;gap:14px;padding:14px 22px;align-items:center;border-bottom:1px solid var(--grey)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;background:#eef2ff;color:#3442ad;border:1px solid #dbe3ff}
    select,button{font-family:inherit;font-size:14px;padding:10px 14px;border-radius:12px;border:1px solid var(--grey);background:#fff;transition:transform .12s ease,box-shadow .2s ease,border-color .2s ease,background-color .2s ease,opacity .2s ease}
    select{min-width:220px;cursor:pointer}
    .ghost{border-style:dashed;color:#64748b}
    button.primary{background:var(--success);border-color:#27aa3d;color:#fff;box-shadow:0 3px 0 #27aa3d}
    button.warn{background:#ffe8c2;border-color:#ffd28a;color:#8a4b00}
    button:hover,select:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.08)}
    button:active{transform:translateY(0) scale(.98);box-shadow:0 2px 8px rgba(0,0,0,.06)}
    button:focus-visible,select:focus-visible{outline:3px solid #c7d2fe;outline-offset:2px;border-color:#c7d2fe}
    button:disabled{opacity:.6;cursor:not-allowed;box-shadow:none;transform:none}
    .toggle{display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--grey);border-radius:12px;background:#fff;font-size:14px;cursor:pointer;transition:transform .12s}
    .toggle:hover{transform:translateY(-1px)}
    .toggle input{appearance:none;-webkit-appearance:none;width:18px;height:18px;border-radius:6px;border:2px solid #9aa3b2;display:grid;place-items:center}
    .toggle input:checked{background:var(--primary);border-color:var(--primary)}
    .toggle input:checked::after{content:"✓";font-size:12px;color:#fff;transform:translateY(-1px)}
    .timer{margin-left:auto;display:flex;align-items:center;gap:10px;font-weight:600}
    .timer .count{width:70px;text-align:center;padding:8px 10px;border:1px solid var(--grey);border-radius:10px}
    .progressbar{position:relative;height:9px;background:#eef2ff;border-radius:999px;overflow:hidden}
    .progressbar>i{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,#7aa4ff,#4c82f7);transition:width .35s ease}
    .task{padding:20px 22px 10px;display:grid;gap:12px;border-bottom:1px solid var(--grey)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{background:#f3f4f6;border:1px solid #e5e7eb;padding:6px 10px;border-radius:12px;font-size:12px}
    .panel{border:1px solid var(--grey);border-radius:14px;padding:12px;background:#fbfbfb;animation:fadeIn .2s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(2px)}to{opacity:1;transform:none}}
    .muted{color:#6b7280}
    .karaoke{font-family:ui-monospace,Menlo,Consolas,monospace;background:#fff;border:1px dashed var(--grey);border-radius:12px;padding:12px;min-height:44px;overflow-x:auto}
    .word{display:inline-block;margin:0 2px;padding:2px 4px;border-radius:6px}
    .word.ok{background:#eaf9ef}.word.bad{background:#ffe9e7;text-decoration:underline wavy var(--danger)}.word.miss{background:#fff5d3;color:#8a4b00}.word.extra{background:#f1f5f9;color:#475569}
    .statgrid{display:grid;grid-template-columns:repeat(4,minmax(90px,1fr));gap:10px}
    .stat{border:1px solid var(--grey);border-radius:12px;padding:10px;background:#fff;text-align:center}
    .stat .h{font-size:12px;color:#6b7280}.stat .v{font-size:18px;font-weight:700}
    .help{padding:0 22px 18px}
    details{border:1px dashed var(--grey);border-radius:12px;padding:10px 12px;background:#fcfcff}
    summary{cursor:pointer;font-weight:600;margin:6px 0}
    .guide-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
    .guide-card{border:1px dashed var(--grey);border-radius:12px;padding:10px;background:#fcfcff}
    .guide-card h4{margin:0 0 6px;font-size:14px}
    .guide-card ul{margin:0;padding-left:18px}
    @media(max-width:900px){.guide-grid{grid-template-columns:1fr}}
    @media(max-width:720px){.statgrid{grid-template-columns:repeat(2,1fr)}}
    @media(prefers-reduced-motion:reduce){*{transition:none!important;animation:none!important}}
  </style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="logo">DET</div>
    <h1>Speak About the Photo — 5 sentences</h1>
    <div class="sub">90s • Web Speech API • TTS + STT • Duolingo-style</div>
  </header>

  <div class="toolbar">
    <div class="controls">
      <span class="badge">Template Set</span>
      <select id="setSelect"></select>

      <span class="badge">Sentence</span>
      <select id="sentSelect">
        <option value="0">1) Opening – General</option>
        <option value="1">2) Description – Clothes & Actions</option>
        <option value="2">3) Background – Setting</option>
        <option value="3">4) Inference – Context</option>
        <option value="4">5) Reflection – Closing</option>
      </select>

      <span class="badge">Options</span>
      <label class="toggle"><input type="checkbox" id="showTarget"> Show target</label>
      <label class="toggle"><input type="checkbox" id="guideToggle"> Show guide</label>
      <label class="toggle"><input type="checkbox" id="fullToggle"> Full Set (1–5)</label>
      <label class="toggle"><input type="checkbox" id="timerToggle" checked> Use 90s timer</label>

      <button id="startBtn" class="primary">Start</button>
      <button id="resetBtn" class="ghost">Reset</button>
      <button id="openCustomBtn" class="ghost">New Template</button>
    </div>
    <div class="timer">
      <span>⏳</span>
      <div class="count" id="timeCount">90</div>
    </div>
  </div>

  <section class="task">
    <div class="row">
      <span class="pill" id="setTitle">—</span>
      <span class="pill" id="partTitle">—</span>
      <div class="progressbar" style="flex:1;min-width:140px;height:8px"><i id="progressBar"></i></div>
    </div>

    <div class="panel">
      <div class="row" style="align-items:flex-start;gap:10px">
        <div style="flex:1;min-width:260px">
          <div class="row" style="gap:8px;margin-bottom:10px;flex-wrap:wrap">
            <button id="listenBtn">🔊 Listen</button>
            <button id="listenFullBtn">🔊 Listen Full (1–5)</button>
            <button id="recBtn" class="warn">🎙️ Record</button>
            <button id="recFullBtn" class="warn">🎙️ Record Full (1–5)</button>
            <button id="stopBtn" disabled>■ Stop</button>
            <span class="muted">Language: en-US</span>
          </div>

          <div style="font-weight:600;margin-bottom:6px;display:flex;align-items:center;gap:8px">
            <span>🎤 Speak & Compare — word-by-word</span>
            <span class="muted" style="margin-left:auto;font-size:12px">Legend:
              <span class="word ok">ok</span>
              <span class="word bad">bad</span>
              <span class="word miss">miss</span>
              <span class="word extra">extra</span>
            </span>
          </div>

          <div class="muted" style="font-size:13px">Target</div>
          <div id="targetLine" class="karaoke" style="min-height:36px"></div>

          <div class="muted" style="margin-top:8px;font-size:13px">Your speech (recognized)</div>
          <div id="recLine" class="karaoke" style="min-height:36px"></div>
        </div>

        <div style="width:300px;display:grid;gap:8px">
          <div class="statgrid">
            <div class="stat"><div class="h">Accuracy</div><div class="v" id="acc">0%</div></div>
            <div class="stat"><div class="h">Words (ok/total)</div><div class="v" id="words">0/0</div></div>
            <div class="stat"><div class="h">Used</div><div class="v" id="used">0s</div></div>
            <div class="stat"><div class="h">WPM</div><div class="v" id="wpm">0</div></div>
          </div>
          <div class="row" style="gap:8px">
            <button id="prevBtn" class="ghost">◀ Prev</button>
            <button id="nextBtn" class="primary">Next ▶</button>
          </div>
          <button id="againBtn" class="ghost" disabled>Try Again (this)</button>
        </div>
      </div>
    </div>
  </section>

  <!-- GUIDE -->
<section class="help" id="guidePanel" style="display:none">
  <details open>
    <summary>🧠 Speak About the Photo – Guided Template (7–9 sentences)</summary>
    <div class="guide-grid">

      <div class="guide-card">
        <h4>1) Opening – What & Where</h4>
        <ul>
          <li>This picture shows … (main subject + place)</li>
          <li>In this photo, I can see … (general overview)</li>
          <li>The image portrays … (scene/activity)</li>
        </ul>
      </div>

      <div class="guide-card">
        <h4>2) Description – What are they doing?</h4>
        <ul>
          <li>They are wearing … (clothes) and seem to be …-ing (activity)</li>
          <li>He/She is …-ing … and looks … (emotion)</li>
          <li>The group is … and their clothes look … (adjective)</li>
        </ul>
      </div>

      <div class="guide-card">
        <h4>3) Background – Where & When</h4>
        <ul>
          <li>Behind them … the sky looks … (bright, cloudy, peaceful)</li>
          <li>In the background, there are … (trees, buildings, ocean, machines)</li>
          <li>In the distance, I can see … (hills, mountains, lights, decorations)</li>
        </ul>
      </div>

      <div class="guide-card">
        <h4>4) Inference – Why / Context</h4>
        <ul>
          <li>It seems that they might … (sell, celebrate, travel)</li>
          <li>Perhaps they are … because … (reason/clue)</li>
          <li>This suggests they are … (event, job, daily life activity)</li>
        </ul>
      </div>

      <div class="guide-card">
        <h4>5) Reflection – How / Opinion</h4>
        <ul>
          <li>This picture reminds me of … (personal memory)</li>
          <li>Looking at this photo, I feel … (happy, grateful, inspired)</li>
          <li>It highlights the importance of … (hard work, nature, technology, family)</li>
        </ul>
      </div>

    </div>
    <p><strong>🔑 Strategy:</strong> 
    Use WH-questions (What, Where, When, Why, How) to expand your answer. 
    Aim for 7–9 sentences (90–110 words) = about 80–90 seconds of speaking. 
    Always add detail → inference → reflection to reach C1 level.</p>
  </details>
</section>

  <!-- REC → FILE -->
  <section class="help">
    <details>
      <summary>🎧 Record to File (MediaRecorder)</summary>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <button id="recFileBtn" class="warn">🎙️ Record to File</button>
        <button id="stopFileBtn" disabled>■ Stop File</button>
        <button id="downloadBtn" disabled>⬇ Download</button>
        <span id="fileInfo" class="muted">—</span>
      </div>
      <audio id="playback" controls style="margin-top:8px;width:100%"></audio>
      <div class="muted" style="font-size:12px;margin-top:6px">
        Web Speech API (SpeechSynthesis & SpeechRecognition) dan MediaRecorder adalah fitur standar gratis di Chrome/Edge/modern browsers.
        SpeechRecognition hanya untuk mic live (tidak bisa transkrip file). Untuk transkrip file, butuh library tambahan (mis. Vosk/Whisper WASM) atau layanan cloud.
      </div>
    </details>
  </section>

  <!-- CUSTOM -->
  <section class="help" id="customPanel" style="display:none">
    <details open>
      <summary>⭐ Custom Templates — create your own 5-sentence set</summary>
      <div class="custom-grid">
        <input type="text" id="cTitle" placeholder="Title (e.g., 🏟️ Stadium concert)"/>
        <div class="row" style="gap:10px;flex-wrap:wrap">
          <textarea id="cS1" rows="3" style="flex:1;min-width:260px" placeholder="1) Opening"></textarea>
          <textarea id="cS2" rows="3" style="flex:1;min-width:260px" placeholder="2) Description"></textarea>
          <textarea id="cS3" rows="3" style="flex:1;min-width:260px" placeholder="3) Background"></textarea>
          <textarea id="cS4" rows="3" style="flex:1;min-width:260px" placeholder="4) Inference"></textarea>
          <textarea id="cS5" rows="3" style="flex:1;min-width:260px" placeholder="5) Reflection"></textarea>
        </div>
        <div class="row" style="gap:10px">
          <button id="saveCustomBtn" class="primary">Save Template</button>
          <button id="clearCustomBtn" class="ghost">Clear</button>
          <button id="openCustomBtn2" class="ghost">Close</button>
        </div>
        <div class="custom-list" id="customList"></div>
      </div>
    </details>
  </section>

  <footer>
    <div class="muted">Progress: <span id="progressText">0 sentences • best accuracy —%</span></div>
    <div class="muted">Made for DET — speaking practice (English only)</div>
  </footer>
</div>

<script src="script.js" defer></script>
</body>
</html>
